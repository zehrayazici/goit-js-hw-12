{"version":3,"file":"page-2.js","sources":["../src/js/gallery.js"],"sourcesContent":["import axios from \"axios\";\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst API_KEY = \"47873630-6df1888e9a425e125fd567ab2\";\nconst BASE_URL = \"https://pixabay.com/api/\";\nconst PER_PAGE = 40;\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const form = document.querySelector(\"#search-form\");\n  const gallery = document.querySelector(\".gallery\");\n  const loader = document.querySelector(\".loader\");\n  const loadMoreBtn = document.querySelector(\".load-more\");\n\n  let currentPage = 1;\n  let currentQuery = \"\";\n  let totalHits = 0;\n  let lightbox = null;\n\n  form.addEventListener(\"submit\", onSearch);\n  loadMoreBtn.addEventListener(\"click\", onLoadMore);\n\n  async function onSearch(event) {\n    event.preventDefault();\n\n    currentQuery = event.currentTarget.elements.query.value.trim();\n\n    if (!currentQuery) {\n      iziToast.warning({\n        message: \"Please enter a search query.\",\n        position: \"topRight\",\n      });\n      return;\n    }\n\n    currentPage = 1;\n    totalHits = 0;\n    gallery.innerHTML = \"\";\n    loadMoreBtn.classList.add(\"is-hidden\");\n\n    await fetchAndRenderImages();\n  }\n\n  async function onLoadMore() {\n    currentPage += 1;\n    await fetchAndRenderImages();\n  }\n\n  async function fetchAndRenderImages() {\n    loader.classList.remove(\"is-hidden\");\n    loadMoreBtn.classList.add(\"is-hidden\");\n\n    try {\n      const data = await fetchImages(currentQuery, currentPage);\n\n      if (data.hits.length === 0 && currentPage === 1) {\n        iziToast.error({\n          message:\n            \"Sorry, there are no images matching your search query. Please try again!\",\n          position: \"topRight\",\n        });\n        return;\n      }\n\n      totalHits = data.totalHits;\n      \n      renderGallery(data.hits);\n\n      if (!lightbox) {\n        lightbox = new SimpleLightbox(\".gallery a\", {\n          captionsData: \"alt\",\n          captionDelay: 250,\n        });\n      } else {\n        lightbox.refresh();\n      }\n\n      const totalLoaded = currentPage * PER_PAGE;\n\n      if (totalLoaded >= totalHits) {\n        loadMoreBtn.classList.add(\"is-hidden\");\n        \n\n        if (currentPage > 1) {\n          iziToast.info({\n            message:\n              \"We're sorry, but you've reached the end of search results.\",\n            position: \"topRight\",\n          });\n        }\n      } else {\n        loadMoreBtn.classList.remove(\"is-hidden\");\n      }\n\n      if (currentPage > 1) {\n        smoothScroll();\n      }\n    } catch (error) {\n      console.error(error);\n      iziToast.error({\n        message: \"Something went wrong. Please try again later!\",\n        position: \"topRight\",\n      });\n    } finally {\n      loader.classList.add(\"is-hidden\");\n    }\n  }\n\n  async function fetchImages(query, page) {\n    const response = await axios.get(BASE_URL, {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: \"photo\",\n        orientation: \"horizontal\",\n        safesearch: true,\n        page,\n        per_page: PER_PAGE,\n      },\n    });\n\n    return response.data;\n  }\n\n  function renderGallery(images) {\n    const markup = images\n      .map(\n        ({\n          webformatURL,\n          largeImageURL,\n          tags,\n          likes,\n          views,\n          comments,\n          downloads,\n        }) => `\n        <li class=\"gallery-item\">\n          <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n            <div class=\"info\">\n              <p><b>Likes</b><br>${likes}</p>\n              <p><b>Views</b><br>${views}</p>\n              <p><b>Comments</b><br>${comments}</p>\n              <p><b>Downloads</b><br>${downloads}</p>\n            </div>\n          </a>\n        </li>\n      `\n      )\n      .join(\"\");\n\n    gallery.insertAdjacentHTML(\"beforeend\", markup);\n  }\n\n  function smoothScroll() {\n    const { height } = gallery.firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n      top: height * 2,\n      behavior: \"smooth\",\n    });\n  }\n});"],"names":["API_KEY","BASE_URL","PER_PAGE","form","gallery","loader","loadMoreBtn","currentPage","currentQuery","totalHits","lightbox","onSearch","onLoadMore","event","iziToast","fetchAndRenderImages","data","fetchImages","renderGallery","SimpleLightbox","smoothScroll","error","query","page","axios","images","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","height"],"mappings":"kHAMA,MAAMA,EAAU,qCACVC,EAAW,2BACXC,EAAW,GAEjB,SAAS,iBAAiB,mBAAoB,IAAM,CAClD,MAAMC,EAAO,SAAS,cAAc,cAAc,EAC5CC,EAAU,SAAS,cAAc,UAAU,EAC3CC,EAAS,SAAS,cAAc,SAAS,EACzCC,EAAc,SAAS,cAAc,YAAY,EAEvD,IAAIC,EAAc,EACdC,EAAe,GACfC,EAAY,EACZC,EAAW,KAEfP,EAAK,iBAAiB,SAAUQ,CAAQ,EACxCL,EAAY,iBAAiB,QAASM,CAAU,EAEhD,eAAeD,EAASE,EAAO,CAK7B,GAJAA,EAAM,eAAc,EAEpBL,EAAeK,EAAM,cAAc,SAAS,MAAM,MAAM,KAAI,EAExD,CAACL,EAAc,CACjBM,EAAS,QAAQ,CACf,QAAS,+BACT,SAAU,UAClB,CAAO,EACD,MACF,CAEAP,EAAc,EACdE,EAAY,EACZL,EAAQ,UAAY,GACpBE,EAAY,UAAU,IAAI,WAAW,EAErC,MAAMS,EAAoB,CAC5B,CAEA,eAAeH,GAAa,CAC1BL,GAAe,EACf,MAAMQ,EAAoB,CAC5B,CAEA,eAAeA,GAAuB,CACpCV,EAAO,UAAU,OAAO,WAAW,EACnCC,EAAY,UAAU,IAAI,WAAW,EAErC,GAAI,CACF,MAAMU,EAAO,MAAMC,EAAYT,EAAcD,CAAW,EAExD,GAAIS,EAAK,KAAK,SAAW,GAAKT,IAAgB,EAAG,CAC/CO,EAAS,MAAM,CACb,QACE,2EACF,SAAU,UACpB,CAAS,EACD,MACF,CAEAL,EAAYO,EAAK,UAEjBE,EAAcF,EAAK,IAAI,EAElBN,EAMHA,EAAS,QAAO,EALhBA,EAAW,IAAIS,EAAe,aAAc,CAC1C,aAAc,MACd,aAAc,GACxB,CAAS,EAKiBZ,EAAcL,GAEfO,GACjBH,EAAY,UAAU,IAAI,WAAW,EAGjCC,EAAc,GAChBO,EAAS,KAAK,CACZ,QACE,6DACF,SAAU,UACtB,CAAW,GAGHR,EAAY,UAAU,OAAO,WAAW,EAGtCC,EAAc,GAChBa,EAAY,CAEhB,OAASC,EAAO,CACd,QAAQ,MAAMA,CAAK,EACnBP,EAAS,MAAM,CACb,QAAS,gDACT,SAAU,UAClB,CAAO,CACH,QAAC,CACCT,EAAO,UAAU,IAAI,WAAW,CAClC,CACF,CAEA,eAAeY,EAAYK,EAAOC,EAAM,CAatC,OAZiB,MAAMC,EAAM,IAAIvB,EAAU,CACzC,OAAQ,CACN,IAAKD,EACL,EAAGsB,EACH,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,KAAAC,EACA,SAAUrB,CAClB,CACA,CAAK,GAEe,IAClB,CAEA,SAASgB,EAAcO,EAAQ,CAC7B,MAAMC,EAASD,EACZ,IACC,CAAC,CACC,aAAAE,EACA,cAAAC,EACA,KAAAC,EACA,MAAAC,EACA,MAAAC,EACA,SAAAC,EACA,UAAAC,CACV,IAAc;AAAA;AAAA,0CAE4BL,CAAa;AAAA,wBAC/BD,CAAY,UAAUE,CAAI;AAAA;AAAA,mCAEfC,CAAK;AAAA,mCACLC,CAAK;AAAA,sCACFC,CAAQ;AAAA,uCACPC,CAAS;AAAA;AAAA;AAAA;AAAA,OAKhD,EACO,KAAK,EAAE,EAEV7B,EAAQ,mBAAmB,YAAasB,CAAM,CAChD,CAEA,SAASN,GAAe,CACtB,KAAM,CAAE,OAAAc,CAAM,EAAK9B,EAAQ,kBAAkB,sBAAqB,EAElE,OAAO,SAAS,CACd,IAAK8B,EAAS,EACd,SAAU,QAChB,CAAK,CACH,CACF,CAAC"}